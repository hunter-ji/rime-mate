# Rime Mate - GitHub Copilot Instructions

## Project Overview

Rime Mate (Rime 配置助手) is a cross-platform CLI tool that simplifies configuration management for the Rime Input Method Engine (IME) on macOS and Linux. It provides a visual, menu-driven interface to help non-technical users install dictionaries, manage extensions, and configure Rime without editing complex YAML configuration files directly.

**Target Users**: Non-programmers who want to use Rime IME but find manual configuration intimidating.

**Key Features**:
- Visual TUI-based configuration interface using Charmbracelet Bubbletea
- One-click installation of dictionary packages (e.g., 薄荷输入法/Mint Input, 雾凇拼音/Rime Ice)
- Language model integration (万象语言模型)
- Cross-platform support for macOS (Squirrel) and Linux (IBus-Rime, Fcitx5-Rime)
- Automatic handling of Rime configuration paths and dependencies

## Tech Stack

- **Language**: Go 1.25+
- **TUI Framework**: [Charmbracelet Bubbletea](https://github.com/charmbracelet/bubbletea) with Lipgloss for styling
- **Configuration Format**: YAML (parsed with goccy/go-yaml)
- **Build System**: Standard Go toolchain with vendored dependencies
- **Platforms**: macOS (Intel + Apple Silicon) and Linux (x86_64 + ARM64)

## Project Structure

```
/
├── main.go              # Entry point
├── build_cli.go         # Main TUI application (Bubbletea model)
├── module/              # Feature modules
│   ├── config.go        # Module package definition
│   ├── ohMyRime/        # 薄荷输入法 (Mint Input) integration
│   │   ├── lang_model.go    # Language model installation/removal
│   │   ├── resources.go     # Resource URLs and constants
│   │   └── module.go        # Package declaration
│   └── rimeIce/         # 雾凇拼音 (Rime Ice) integration (planned)
├── util/                # Utility functions
│   ├── download.go      # File download helpers
│   ├── log.go           # Colored console output
│   ├── transform_path.go # Path manipulation utilities
│   └── yaml_reader.go   # YAML parsing utilities
├── build.sh             # Build script for all platforms
├── setup.sh             # Installation script for end users
└── .github/
    └── workflows/
        └── build.yml    # CI/CD for releases
```

## Build and Test

### Building

```bash
# Build for all platforms (requires vendored dependencies)
./build.sh

# Build for specific platform
GOOS=darwin GOARCH=arm64 go build -ldflags="-s -w" -mod=vendor -o rime-mate .
```

**Note**: This project uses vendored dependencies (`go mod vendor`). Always run `go mod vendor` after adding/updating dependencies.

### Testing

**Currently, there are no automated tests in this repository.** When adding code:
- Manually test cross-platform functionality on both macOS and Linux if possible
- Verify TUI rendering and keyboard navigation (↑/↓/Enter/q)
- Test file downloads and YAML configuration modifications
- Ensure error messages are user-friendly (in Chinese, targeting non-technical users)

### Running Locally

```bash
go run .
```

## Code Conventions

### Language and Comments
- **User-facing messages**: Chinese (Simplified) - this tool is designed for Chinese-speaking users
- **Code comments**: Chinese is acceptable for domain-specific explanations, but English is preferred for technical comments
- **Variable/function names**: English

### Code Style
- Follow standard Go conventions (use `gofmt`)
- Use descriptive variable names
- Keep functions focused and small
- Error messages should be clear and actionable for non-technical users

### Rime-Specific Conventions
- **Rime configuration directory paths**:
  - macOS: `~/Library/Rime`
  - Linux IBus: `~/.config/ibus/rime`
  - Linux Fcitx5: `~/.local/share/fcitx5/rime`
- Always use `getCrossPlatformRimeDir()` to determine the correct path
- YAML configuration files typically end with `.custom.yaml` for user customizations
- Schema files end with `.schema.yaml`

### Module Structure
- Each Rime configuration variant (e.g., Mint Input, Rime Ice) gets its own module under `module/`
- Modules should export functions for installation, update, and configuration operations
- Use the `util` package for common operations (downloads, logging, path handling)

### UI/UX Guidelines
- Menu navigation uses arrow keys (↑/↓) and Enter to select
- 'q' or Ctrl+C to quit
- Disabled menu items should be marked with "(即将到来)" (coming soon)
- Use colored output sparingly and consistently (see `util/log.go`)
- All TUI styling should use Lipgloss styles defined at the top of `build_cli.go`

## Important Files and Directories

### Don't Modify
- `vendor/` - Vendored dependencies (regenerated by `go mod vendor`)
- `output/` - Build artifacts directory
- `go.sum` - Dependency checksums (managed by Go modules)

### Key Files
- `build_cli.go` - Main TUI logic and menu structure
- `module/ohMyRime/lang_model.go` - Language model installation logic
- `util/download.go` - Handles file downloads with fallback URLs (GitHub + China mirror)

## Cross-Platform Considerations

- Use `runtime.GOOS` and `runtime.GOARCH` for platform detection
- File paths must use `filepath.Join()` for cross-platform compatibility
- Test on both macOS and Linux when possible
- Consider that Linux users may have either IBus or Fcitx5
- macOS users may have Intel or Apple Silicon Macs

## External Resources

- Language models and dictionaries are downloaded from GitHub releases or mirror sites
- Always provide fallback URLs (typically GitHub + a China-based mirror for better accessibility)
- Large files (like `.gram` language models) should show progress or informative messages

## Security and Privacy

- This tool only modifies local Rime configuration files
- No user data is uploaded or transmitted
- Downloaded resources should be from trusted sources (official repositories)
- Verify file integrity when possible

## Development Guidelines

When working on this codebase:

1. **Preserve user-friendliness**: This tool targets non-programmers. Keep error messages clear and in Chinese.
2. **Test cross-platform**: If you can't test on all platforms, document which platforms you tested.
3. **Maintain backward compatibility**: Users upgrade by running the install script again.
4. **Document new features**: Update README.md if adding user-facing features.
5. **Keep dependencies minimal**: Only add new dependencies if absolutely necessary.
6. **Use vendored mode**: Always build with `-mod=vendor` for reproducible builds.

## Common Tasks

### Adding a New Dictionary/Schema Module

1. Create a new directory under `module/` (e.g., `module/rimeIce/`)
2. Implement installation and update functions
3. Add constants for resource URLs in `resources.go`
4. Update the menu structure in `build_cli.go`
5. Add menu items to either `mainMenu` or create a new submenu

### Adding a New Menu Item

1. Define the item in `initialModel()` in `build_cli.go`
2. Add a case in the `Update()` function's switch statement to handle selection
3. Implement the action function (usually in a module package)
4. Test keyboard navigation and ensure disabled items are properly marked

### Updating Dependencies

```bash
go get -u <package>
go mod tidy
go mod vendor  # Always vendor after updating
```

## References

- [Rime Input Method Engine](https://rime.im/)
- [薄荷输入法 (Mint Input)](https://github.com/Mintimate/oh-my-rime)
- [雾凇拼音 (Rime Ice)](https://github.com/iDvel/rime-ice)
- [Charmbracelet Bubbletea](https://github.com/charmbracelet/bubbletea)
